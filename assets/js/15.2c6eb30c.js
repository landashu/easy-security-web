(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{496:function(s,n,a){"use strict";a.r(n);var e=a(41),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("p",[s._v("easy-security 基于过滤器实现的一款配合 spring 快速开发的安全认证框架，思想是希望通过简单的配置，并且实现核心的方法达到认证和鉴权的目的。")]),s._v(" "),a("p",[s._v("easy-security 不限制存取 token 方式，无论是保存到服务端还是使用 JWT 等都可以，因为这部分是由开发者自己来定义的，只需要告诉 easy-security 该如何获取用户信息即可。")]),s._v(" "),a("p",[s._v("如果你使用了 easy-security 自身所带的 Req 请求封装，那么所有的接口请求均以 POST 方式，Req 会把认证后的用户所携带在每次请求中，当需要获取用户的时候可以通过 Req 直接获取，解耦开发者获取认证用户的")]),s._v(" "),a("p",[s._v("easy-security 结合了 Yapi 的使用，如果你使用 Yapi 需要在自己的项目中描述规则")]),s._v(" "),a("h2",{attrs:{id:"功能列举"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能列举"}},[s._v("#")]),s._v(" 功能列举")]),s._v(" "),a("ul",[a("li",[s._v("认证拦截")]),s._v(" "),a("li",[s._v("权限校验")]),s._v(" "),a("li",[s._v("用户获取")]),s._v(" "),a("li",[s._v("黑名单")]),s._v(" "),a("li",[s._v("密文传输 (内置 AES 加密算法)")])]),s._v(" "),a("h2",{attrs:{id:"使用四步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用四步"}},[s._v("#")]),s._v(" 使用四步")]),s._v(" "),a("h3",{attrs:{id:"第一步-添加依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一步-添加依赖"}},[s._v("#")]),s._v(" 第一步 添加依赖")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<dependency>\n  <groupId>com.aizuda</groupId>\n  <artifactId>easy-security-boot-starter</artifactId>\n  <version>1.0.0</version>\n</dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"第二步-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二步-配置"}},[s._v("#")]),s._v(" 第二步 配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('easy\n  security:\n    # 开启认证\n    auth-enable: true\n    # 开启鉴权\n    authorize-enable: true\n    # 开启 Req 请求封装\n    request-data-enable: true\n    # 项目路径，不会被认证，但依然会封装 Req\n    project-url: \n      - /sysUser/login\n      - /goods/getIndex\n      - /goods/getGoodsInfo\n    # 需要加解密的路径，前端数据解密，后端返回数据加密\n    decrypt-url: ""\n    # 特殊路径，不受认证鉴权影响，不会封装 Req\n    special-url: \n      - /oss/**\n    # 黑名单\n    black-list: \n      - 192.168.148.42\n      - 192.168.148.41\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"第三步-实现easysecurityserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三步-实现easysecurityserver"}},[s._v("#")]),s._v(" 第三步 实现 EasySecurityServer")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('@Service\n@Slf4j\npublic class AuthConfig implements EasySecurityServer {\n    \n    // 描述用户获取的方式，可以用token从redis获取，自己实现，也可以是JWT自己解析\n    @Override\n    public Object getAuthUser(String token) throws BasicException{\n        JWT jwt = JWT.of(token);\n        // 验证\n        if(!jwt.setKey(key.getBytes()).verify()){\n            throw new BasicException(BasicCode.BASIC_CODE_99986);\n        }\n        // 是否失效\n        Long exp = Long.valueOf(jwt.getPayload("exp").toString());\n        if(System.currentTimeMillis() > exp){\n            throw new BasicException(BasicCode.BASIC_CODE_99985);\n        }\n        // 返回用户\n        User user = new User();\n        user.setId(jwt.getPayload("id").toString());\n        user.setName(jwt.getPayload("name").toString());\n        user.setUrl((List<String>) jwt.getPayload("url"));\n        return user;\n    }\n\n    // 描述用户更获取权限集，可以用token从redis获取，自己实现\n    // 也可以使用JWT自己解析数据\n    @Override\n    public List<String> getAuthorizeUrl(String token) throws BasicException{\n        User authUser = (User) getAuthUser(token);\n        return authUser.getUrl();\n    }\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("h3",{attrs:{id:"第四步-获取用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第四步-获取用户"}},[s._v("#")]),s._v(" 第四步 获取用户")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 模拟登录，登录成功会给前端token，前端需要把token放在Headers中\n@PostMapping("/login")\npublic Rep<User> login(){\n    User user = new User();\n    user.setId("1");\n    user.setName("张三");\n    String token = JWT.create()\n            .setPayload("id",1)\n            .setPayload("name","张三")\n            .setPayload("exp", System.currentTimeMillis()+60*60*1000)\n            .setPayload("url", Arrays.asList("/test/abc"))\n            .setKey(key.getBytes())\n            .sign();\n    user.setToken(token);\n    return Rep.ok(user);\n}\n\n// Req<T,U> 第一个参数为前端所传参数，第二个为后端会获取到的用户数据，\n@PostMapping("/abc")\npublic Rep<String> test(@RequestBody Req<Object,User> req){\n    // 获取前端传参\n    String str = req.getData().toString();\n    // 获取操作用户\n    User user = req.getUser();\n    return Rep.ok(user.getName());\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h2",{attrs:{id:"yapi规则描述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#yapi规则描述"}},[s._v("#")]),s._v(" Yapi 规则描述")]),s._v(" "),a("p",[s._v("在项目中的 application.yml 文件里面添加如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('field:\n  required: "@com.aizuda.easy.security.annotation.yapi.YApiRule#required"\n  default:\n    value: "#default"\njson:\n  rule:\n    field:\n      ignore: "@com.aizuda.easy.security.annotation.yapi.YApiRule#hide"\n\nmethod:\n  additional:\n    header[!@com.aizuda.easy.security.annotation.yapi.YApiRule]: \'{name: "token",value: "ddb9ba4f842529e539560b0a6df23408de27dbed00860a1c3c5af04d44fa3c39",required: true}\'\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);