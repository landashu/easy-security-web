(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{501:function(s,n,e){"use strict";e.r(n);var a=e(41),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"第一步-添加依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第一步-添加依赖"}},[s._v("#")]),s._v(" 第一步 添加依赖")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<dependency>\n  <groupId>com.aizuda</groupId>\n  <artifactId>easy-security-boot-starter</artifactId>\n  <version>${latest-version}</version>\n</dependency>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"第二步-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第二步-配置"}},[s._v("#")]),s._v(" 第二步 配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('easy\n  security:\n    # 开启认证\n    auth-enable: true\n    # 开启鉴权\n    authorize-enable: true\n    # 开启 Req 请求封装\n    request-data-enable: true\n    # 项目路径，不会被认证，但依然会封装 Req\n    project-url: \n      - /sysUser/login\n      - /goods/getIndex\n      - /goods/getGoodsInfo\n    # 需要加解密的路径，前端数据解密，后端返回数据加密\n    decrypt-url: ""\n    # 特殊路径，不受认证鉴权影响，不会封装 Req\n    special-url: \n      - /oss/**\n    # 黑名单\n    black-list: \n      - 192.168.148.42\n      - 192.168.148.41\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("h2",{attrs:{id:"第三步-实现easysecurityserver"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三步-实现easysecurityserver"}},[s._v("#")]),s._v(" 第三步 实现 EasySecurityServer")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('@Service\n@Slf4j\npublic class AuthConfig implements EasySecurityServer {\n    \n    // 描述用户获取的方式，可以用token从redis获取，自己实现，也可以是JWT自己解析\n    @Override\n    public Object getAuthUser(String token) throws BasicException{\n        JWT jwt = JWT.of(token);\n        // 验证\n        if(!jwt.setKey(key.getBytes()).verify()){\n            throw new BasicException(BasicCode.BASIC_CODE_99986);\n        }\n        // 是否失效\n        Long exp = Long.valueOf(jwt.getPayload("exp").toString());\n        if(System.currentTimeMillis() > exp){\n            throw new BasicException(BasicCode.BASIC_CODE_99985);\n        }\n        // 返回用户\n        User user = new User();\n        user.setId(jwt.getPayload("id").toString());\n        user.setName(jwt.getPayload("name").toString());\n        user.setUrl((List<String>) jwt.getPayload("url"));\n        return user;\n    }\n\n    // 描述用户更获取权限集，可以用token从redis获取，自己实现\n    // 也可以使用JWT自己解析数据\n    @Override\n    public List<String> getAuthorizeUrl(String token) throws BasicException{\n        User authUser = (User) getAuthUser(token);\n        return authUser.getUrl();\n    }\n\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br")])]),e("h2",{attrs:{id:"第四步-获取用户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第四步-获取用户"}},[s._v("#")]),s._v(" 第四步 获取用户")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('// 模拟登录，登录成功会给前端token，前端需要把token放在Headers中\n@PostMapping("/login")\npublic Rep<User> login(){\n    User user = new User();\n    user.setId("1");\n    user.setName("张三");\n    String token = JWT.create()\n            .setPayload("id",1)\n            .setPayload("name","张三")\n            .setPayload("exp", System.currentTimeMillis()+60*60*1000)\n            .setPayload("url", Arrays.asList("/test/abc"))\n            .setKey(key.getBytes())\n            .sign();\n    user.setToken(token);\n    return Rep.ok(user);\n}\n\n// Req<T,U> 第一个参数为前端所传参数，第二个为后端会获取到的用户数据，\n@PostMapping("/abc")\npublic Rep<String> test(@RequestBody Req<Object,User> req){\n    // 获取前端传参\n    String str = req.getData().toString();\n    // 获取操作用户\n    User user = req.getUser();\n    return Rep.ok(user.getName());\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("h2",{attrs:{id:"yapi规则描述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yapi规则描述"}},[s._v("#")]),s._v(" Yapi 规则描述")]),s._v(" "),e("p",[s._v("YAPI 是一个优秀的代码无侵入的接口文档，只需要按照我们正常的注解去描述我们方法的作用，使用 Idea 插件，就会自动帮我们生成接口文档。")]),s._v(" "),e("p",[s._v("本框架对 YAPI 做了一些小功能，隐藏 Req 类中多余的字段，只放出 data 属性显示到文档中，您需要在项目中的 application.yml 文件里面添加如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('field:\n  required: "@com.aizuda.easy.security.annotation.yapi.YApiRule#required"\n  default:\n    value: "#default"\njson:\n  rule:\n    field:\n      ignore: "@com.aizuda.easy.security.annotation.yapi.YApiRule#hide"\n\nmethod:\n  additional:\n    header[!@com.aizuda.easy.security.annotation.yapi.YApiRule]: \'{name: "token",value: "ddb9ba4f842529e539560b0a6df23408de27dbed00860a1c3c5af04d44fa3c39",required: true}\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("如果不使用配置则会在这个文档中显示多余的 user 和 token 字段。")])])}),[],!1,null,null,null);n.default=t.exports}}]);